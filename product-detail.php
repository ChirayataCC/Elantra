<?php include 'layouts/header.php' ?>
<div id="product-detail"></div>
<!-- breadcrumb -->
<div class="tf-breadcrumb">
    <div class="container">
        <div class="tf-breadcrumb-wrap d-flex justify-content-between flex-wrap align-items-center">
            <div class="tf-breadcrumb-list">
                <a href="index.php" class="text">Home</a>
                <i class="icon icon-arrow-right"></i>
                <a href="shop.php" class="text">Women</a>
                <i class="icon icon-arrow-right"></i>
                <span class="text">Cotton jersey top</span>
            </div>
        </div>
    </div>
</div>
<!-- /breadcrumb -->
<!-- default -->
<section class="flat-spacing-4 pt_0">
    <div class="tf-main-product section-image-zoom">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="tf-product-media-wrap sticky-top">
                        <div class="thumbs-slider">
                            <div dir="ltr" class="swiper tf-product-media-thumbs other-image-zoom"
                                data-direction="vertical">
                                <div class="swiper-wrapper">
                                    
                                </div>
                            </div>
                            <div dir="ltr" class="swiper tf-product-media-main" id="gallery-swiper-started">
                                <div class="swiper-wrapper">
                                </div>
                                <div class="swiper-button-next button-style-arrow thumbs-next"></div>
                                <div class="swiper-button-prev button-style-arrow thumbs-prev"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="tf-product-info-wrap position-relative">
                        <div class="tf-zoom-main"></div>
                        <div class="tf-product-info-list other-image-zoom">
                            <div class="tf-product-info-title">
                                <h5>Cotton jersey top</h5>
                            </div>
                            <div class="tf-product-info-badges">
                                <div class="badges">Best seller</div>
                                <div class="product-status-content">
                                    <i class="icon-lightning"></i>
                                    <p class="fw-6">Selling fast! 56 people have this in their carts.</p>
                                </div>
                            </div>
                            <div class="tf-product-info-price">
                                <div class="price-on-sale">$8.00</div>
                                <div class="compare-at-price">$30.00</div>
                                <div class="badges-on-sale"><span>20</span>% OFF</div>
                            </div>
                            <div class="tf-product-info-variant-picker">
                                <div class="variant-picker-item">
                                    <div class="variant-picker-label">
                                        Color: <span
                                            class="fw-6 variant-picker-label-value value-currentColor">Beige</span>
                                    </div>
                                    <div class="variant-picker-values colorPicker">

                                    </div>
                                </div>
                                <div class="variant-picker-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="variant-picker-label">
                                            Size: <span class="fw-6 variant-picker-label-value sizePickerCaps">S</span>
                                        </div>
                                    </div>
                                    <div class="variant-picker-values sizePicker">

                                    </div>
                                </div>
                            </div>
                            <div class="tf-product-info-quantity">
                                <div class="quantity-title fw-6">Quantity</div>
                                <div class="wg-quantity">
                                    <span class="btn-quantity btn-decrease">-</span>
                                    <input type="text" class="quantity-product" name="number" value="1">
                                    <span class="btn-quantity btn-increase">+</span>
                                </div>
                            </div>
                            <div class="tf-product-info-buy-button">
                                <form class="">
                                    <a href="javascript:void(0);"
                                        class="tf-btn btn-fill justify-content-center fw-6 fs-16 flex-grow-1 animate-hover-btn btn-add-to-cart"><span>Add
                                            to cart</span></a>
                                </form>
                            </div>
                            <div class="tf-product-info-extra-link">
                                <a href="javascript:void(0);" data-bs-toggle="modal" class="tf-product-extra-icon">
                                    <div class="icon">
                                        <i class="icon-question"></i>
                                    </div>
                                    <div class="text fw-6">Ask a question</div>
                                </a>
                                <a href="javascript:void(0);" data-bs-toggle="modal" class="tf-product-extra-icon">
                                    <div class="icon">
                                        <svg class="d-inline-block" xmlns="http://www.w3.org/2000/svg" width="22"
                                            height="18" viewBox="0 0 22 18" fill="currentColor">
                                            <path
                                                d="M21.7872 10.4724C21.7872 9.73685 21.5432 9.00864 21.1002 8.4217L18.7221 5.27043C18.2421 4.63481 17.4804 4.25532 16.684 4.25532H14.9787V2.54885C14.9787 1.14111 13.8334 0 12.4255 0H9.95745V1.69779H12.4255C12.8948 1.69779 13.2766 2.07962 13.2766 2.54885V14.5957H8.15145C7.80021 13.6052 6.85421 12.8936 5.74468 12.8936C4.63515 12.8936 3.68915 13.6052 3.33792 14.5957H2.55319C2.08396 14.5957 1.70213 14.2139 1.70213 13.7447V2.54885C1.70213 2.07962 2.08396 1.69779 2.55319 1.69779H9.95745V0H2.55319C1.14528 0 0 1.14111 0 2.54885V13.7447C0 15.1526 1.14528 16.2979 2.55319 16.2979H3.33792C3.68915 17.2884 4.63515 18 5.74468 18C6.85421 18 7.80021 17.2884 8.15145 16.2979H13.423C13.7742 17.2884 14.7202 18 15.8297 18C16.9393 18 17.8853 17.2884 18.2365 16.2979H21.7872V10.4724ZM16.684 5.95745C16.9494 5.95745 17.2034 6.08396 17.3634 6.29574L19.5166 9.14894H14.9787V5.95745H16.684ZM5.74468 16.2979C5.27545 16.2979 4.89362 15.916 4.89362 15.4468C4.89362 14.9776 5.27545 14.5957 5.74468 14.5957C6.21392 14.5957 6.59575 14.9776 6.59575 15.4468C6.59575 15.916 6.21392 16.2979 5.74468 16.2979ZM15.8298 16.2979C15.3606 16.2979 14.9787 15.916 14.9787 15.4468C14.9787 14.9776 15.3606 14.5957 15.8298 14.5957C16.299 14.5957 16.6809 14.9776 16.6809 15.4468C16.6809 15.916 16.299 16.2979 15.8298 16.2979ZM18.2366 14.5957C17.8853 13.6052 16.9393 12.8936 15.8298 12.8936C15.5398 12.8935 15.252 12.943 14.9787 13.04V10.8511H20.0851V14.5957H18.2366Z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div class="text fw-6">Delivery & Return</div>
                                </a>
                                <a href="javascript:void(0);" data-bs-toggle="modal" class="tf-product-extra-icon">
                                    <div class="icon">
                                        <i class="icon-share"></i>
                                    </div>
                                    <div class="text fw-6">Share</div>
                                </a>
                            </div>
                            <div class="tf-product-info-delivery-return">
                                <div class="row">
                                    <div class="col-xl-6 col-12">
                                        <div class="tf-product-delivery">
                                            <div class="icon">
                                                <i class="icon-delivery-time"></i>
                                            </div>
                                            <p>Estimate delivery times: <span class="fw-7">12-26 days</span>
                                                (International), <span class="fw-7">3-6 days</span> (United
                                                States).</p>
                                        </div>
                                    </div>
                                    <div class="col-xl-6 col-12">
                                        <div class="tf-product-delivery mb-0">
                                            <div class="icon">
                                                <i class="icon-return-order"></i>
                                            </div>
                                            <p>Return within <span class="fw-7">30 days</span> of purchase.
                                                Duties & taxes are non-refundable.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tf-product-info-trust-seal">
                                <div class="tf-product-trust-mess">
                                    <i class="icon-safe"></i>
                                    <p class="fw-6">Guarantee Safe <br> Checkout</p>
                                </div>
                                <div class="tf-payment">
                                    <img src="images/payments/visa.png" alt="">
                                    <img src="images/payments/img-1.png" alt="">
                                    <img src="images/payments/img-2.png" alt="">
                                    <img src="images/payments/img-3.png" alt="">
                                    <img src="images/payments/img-4.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- /default -->
<!-- tabs -->
<section class="flat-spacing-17 pt_0">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="widget-tabs style-has-border">
                    <ul class="widget-menu-tab">
                        <li class="item-title active">
                            <span class="inner">Description</span>
                        </li>
                        <li class="item-title">
                            <span class="inner">Additional Information</span>
                        </li>
                    </ul>
                    <div class="widget-content-tab">
                        <div class="widget-content-inner active">
                            <div class="">
                                <p class="mb_30">
                                    Button-up shirt sleeves and a relaxed silhouette. It’s tailored with drapey,
                                    crinkle-texture fabric that’s made from LENZING™ ECOVERO™ Viscose —
                                    responsibly
                                    sourced wood-based
                                    fibres produced through a process that reduces impact on forests,
                                    biodiversity and
                                    water supply.
                                </p>
                            </div>
                        </div>
                        <div class="widget-content-inner">
                            <table class="tf-pr-attrs">
                                <tbody>
                                    <tr class="tf-attr-pa-color">
                                        <th class="tf-attr-label">Color</th>
                                        <td class="tf-attr-value">
                                            <p>White, Pink, Black</p>
                                        </td>
                                    </tr>
                                    <tr class="tf-attr-pa-size">
                                        <th class="tf-attr-label">Size</th>
                                        <td class="tf-attr-value">
                                            <p>S, M, L, XL</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- /tabs -->

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const productId = params.get('id');
        if (!productId) return;

        fetch('products.json')
            .then(res => res.json())
            .then(products => {
                const product = products.find(p => p.id === productId);
                if (!product) return;

                const container = document.querySelector('.flat-spacing-4');
                const discount = Math.round(((product.compare_price - product.price) / product.compare_price) * 100);

                // Breadcrumb
                const breadcrumb = document.querySelector('.tf-breadcrumb-list');
                if (breadcrumb) {
                    breadcrumb.innerHTML = `
          <a href="index.php" class="text">Home</a>
          <i class="icon icon-arrow-right"></i>
          <a href="shop.php?category=${product.category}" class="text">${product.category}</a>
          <i class="icon icon-arrow-right"></i>
          <span class="text">${product.title}</span>
        `;
                }

                // Sliders
                const thumbsSlider = document.querySelector('.tf-product-media-thumbs .swiper-wrapper');
                const mainSlider = document.querySelector('.tf-product-media-main .swiper-wrapper');
                if (thumbsSlider && mainSlider) {
                    thumbsSlider.innerHTML = product.images.map(img => `
          <div class="swiper-slide">
            <div class="item"><img class="lazyload" src="${img}" alt="img-product"></div>
          </div>
        `).join('');

                    mainSlider.innerHTML = product.images.map(img => `
          <div class="swiper-slide">
            <img class="tf-image-zoom lazyload" src="${img}" alt="">
          </div>
        `).join('');
                }

                // Product Info
                const productInfo = document.querySelector('.tf-product-info-list');
                const addToCartBtn = document.querySelector('.btn-add-to-cart');

                if (productInfo && addToCartBtn) {
                    productInfo.querySelector('h5').textContent = product.title;
                    productInfo.querySelector('.price-on-sale').textContent = `$${product.price}`;
                    productInfo.querySelector('.compare-at-price').textContent = `$${product.compare_price}`;
                    productInfo.querySelector('.badges-on-sale span').textContent = discount;

                    const badgeContainer = productInfo.querySelector('.tf-product-info-badges');
                    badgeContainer.innerHTML = `
          ${product.bestseller ? '<div class="badges">Best seller</div>' : ''}
          ${product.newarrivals ? '<div class="badges">New Arrivals</div>' : ''}
        `;

                    // Color
                    const colorPicker = productInfo.querySelector('.colorPicker');
                    const colorLabel = productInfo.querySelector('.value-currentColor');
                    if (product.color?.length) {
                        colorPicker.innerHTML = product.color.map((color, i) => `
            <input id="values-${color}" type="radio" name="color1" value="${color}" ${i === 0 ? 'checked' : ''}>
            <label class="hover-tooltip radius-60 color-btn" for="values-${color}" data-value="${color}" data-color="${color}">
              <span class="btn-checkbox" style="background: ${color};"></span>
              <span class="tooltip">${color}</span>
            </label>
          `).join('');
                        colorLabel.textContent = product.color[0];
                    } else {
                        colorPicker.closest('.variant-picker-item')?.remove();
                    }

                    // Size
                    const sizePicker = productInfo.querySelector('.sizePicker');
                    const sizeLabel = productInfo.querySelector('.sizePickerCaps');
                    if (product.size?.length) {
                        sizePicker.innerHTML = product.size.map((size, i) => `
            <input type="radio" name="size1" id="values-${size}" value="${size}" ${i === 0 ? 'checked' : ''}>
            <label class="style-text size-btn" for="values-${size}" data-value="${size}">
              <p>${size}</p>
            </label>
          `).join('');
                        sizeLabel.textContent = product.size[0];
                    } else {
                        sizePicker.closest('.variant-picker-item')?.remove();
                    }

                    // Quantity logic
                    const quantityInput = document.querySelector('.wg-quantity .quantity-product');
                    const increaseBtn = document.querySelector('.btn-increase');
                    const decreaseBtn = document.querySelector('.btn-decrease');

                    function updateQuantityAttr() {
                        let qty = parseInt(quantityInput.value);
                        if (isNaN(qty) || qty < 1) qty = 1;
                        quantityInput.value = qty;
                        addToCartBtn.setAttribute('data-quantity', qty);
                    }

                    if (quantityInput && increaseBtn && decreaseBtn) {
                        increaseBtn.addEventListener('click', () => {
                            quantityInput.value = parseInt(quantityInput.value || '1') + 1;
                            updateQuantityAttr();
                        });

                        decreaseBtn.addEventListener('click', () => {
                            quantityInput.value = Math.max(1, parseInt(quantityInput.value || '1') - 1);
                            updateQuantityAttr();
                        });

                        quantityInput.addEventListener('input', updateQuantityAttr);
                        quantityInput.addEventListener('change', updateQuantityAttr);

                        updateQuantityAttr(); // Initial sync
                    }

                    // Initial values for data attributes
                    const defaultColor = product.color?.[0] || '';
                    const defaultSize = product.size?.[0] || '';
                    addToCartBtn.setAttribute('data-product-id', product.id);
                    addToCartBtn.setAttribute('data-color', defaultColor);
                    addToCartBtn.setAttribute('data-size', defaultSize);
                    updateQuantityAttr();

                    // Update on color change
                    colorPicker.querySelectorAll('input[name="color1"]').forEach(input => {
                        input.addEventListener('change', () => {
                            colorLabel.textContent = input.value;
                            addToCartBtn.setAttribute('data-color', input.value);
                        });
                    });

                    // Update on size change
                    sizePicker.querySelectorAll('input[name="size1"]').forEach(input => {
                        input.addEventListener('change', () => {
                            sizeLabel.textContent = input.value;
                            addToCartBtn.setAttribute('data-size', input.value);
                        });
                    });

                    // Description
                    const descriptionTab = document.querySelector('.widget-content-inner.active p');
                    if (descriptionTab) {
                        descriptionTab.textContent = product.description;
                    }

                    // Additional Info
                    const additionalTab = document.querySelector('.widget-content-inner:not(.active)');
                    if (additionalTab) {
                        additionalTab.innerHTML = `
            <table class="tf-pr-attrs">
              <tbody>
                ${product.color ? `
                  <tr><th>Color</th><td>${product.color.join(', ')}</td></tr>` : ''}
                ${product.size ? `
                  <tr><th>Size</th><td>${product.size.join(', ')}</td></tr>` : ''}
              </tbody>
            </table>
          `;
                    }
                }

                // Swiper
                new Swiper('.tf-product-media-main', {
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                    thumbs: {
                        swiper: new Swiper('.tf-product-media-thumbs', {
                            direction: 'horizontal',
                            slidesPerView: 6,
                            spaceBetween: 10,
                            watchSlidesProgress: true,
                            breakpoints: {
                                1149: { direction: 'vertical' }
                            }
                        }),
                    }
                });
            })
            .catch(err => console.error('Error loading products:', err));
    });
</script>


<!-- product -->
<section class="flat-spacing-1 pt_0">
    <div class="container">
        <div class="flat-title">
            <span class="title">People Also Bought</span>
        </div>
        <div class="hover-sw-nav hover-sw-2">
            <div dir="ltr" class="swiper tf-sw-product-sell wrap-sw-over" data-preview="4" data-tablet="3"
                data-mobile="2" data-space-lg="30" data-space-md="15" data-pagination="2" data-pagination-md="3"
                data-pagination-lg="3">
                <div class="related_products swiper-wrapper">

                </div>
            </div>
            <div class="nav-sw nav-next-slider nav-next-product box-icon w_46 round"><span
                    class="icon icon-arrow-left"></span></div>
            <div class="nav-sw nav-prev-slider nav-prev-product box-icon w_46 round"><span
                    class="icon icon-arrow-right"></span></div>
            <div class="sw-dots style-2 sw-pagination-product justify-content-center"></div>
        </div>
    </div>
</section>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const currentProductId = params.get('id');

        if (!currentProductId) return;

        fetch('products.json')
            .then(response => response.json())
            .then(allProducts => {
                // Find current product to get its related products
                const currentProduct = allProducts.find(p => p.id === currentProductId);
                if (!currentProduct?.related_products?.length) return;

                const container = document.querySelector('.related_products');
                if (!container) return;

                // Clear existing content (if any)
                container.innerHTML = '';

                // Get related products data
                currentProduct.related_products.forEach(relatedId => {
                    const product = allProducts.find(p => p.id === relatedId);
                    if (!product) return;

                    // Use first image as main, second as hover (fallback to main if no second image)
                    const mainImg = product.images?.[0] || 'images/placeholder.jpg';
                    const hoverImg = product.images?.[1] || mainImg;

                    // Calculate discount if compare_price exists
                    const discount = product.compare_price
                        ? Math.round(((product.compare_price - product.price) / product.compare_price) * 100)
                        : 0;

                    // HTML template for each product card
                    const html = `
                    <div class="swiper-slide">
                        <div class="card-product fl-item">
                            <div class="card-product-wrapper">
                                <a href="product-detail.php?id=${product.id}" class="product-img">
                                    <img class="lazyload img-product" data-src="${mainImg}" src="${mainImg}" alt="${product.title}">
                                    <img class="lazyload img-hover" data-src="${hoverImg}" src="${hoverImg}" alt="${product.title}">
                                    ${discount > 0 ? `<div class="badges-on-sale"><span>${discount}</span>% OFF</div>` : ''}
                                    ${product.newarrivals ? '<div class="badges">New</div>' : ''}
                                </a>
                                <div class="list-product-btn">
                                    <a href="#quick_add" data-bs-toggle="modal" class="box-icon bg_white quick-add" data-product-id="${product.id}">
                                        <span class="icon icon-bag"></span>
                                        <span class="tooltip">Quick Add</span>
                                    </a>
                                </div>
                            </div>
                            <div class="card-product-info">
                                <a href="product-detail.php?id=${product.id}" class="title link">${product.title}</a>
                                <div class="price-wrapper">
                                    <span class="price">$${product.price.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                    container.insertAdjacentHTML('beforeend', html);
                });

                // Initialize Swiper after products are loaded
                new Swiper('#related-products-swiper', {
                    slidesPerView: 4,
                    spaceBetween: 20,
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                    breakpoints: {
                        0: { slidesPerView: 1 },
                        576: { slidesPerView: 2 },
                        768: { slidesPerView: 3 },
                        992: { slidesPerView: 4 }
                    }
                });
            })
            .catch(error => {
                console.error('Error loading products:', error);
            });
    });
</script>
<!-- /product -->
<?php include 'layouts/footer.php' ?>